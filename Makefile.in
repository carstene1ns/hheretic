# This Makefile understands the following targets:
#
# sdl			build SDL (software) version
# clean:		remove all intermediate files

# Basic stuff
SHELL = /bin/sh
VPATH = @srcdir@

top_srcdir = @top_srcdir@
srcdir = @srcdir@
prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = $(exec_prefix)/bin
infodir = $(prefix)/info
libdir = $(prefix)/lib/gnudl
mandir = $(prefix)/man/man1
includedir = $(prefix)/include

CC = @CC@
DEFS = @DEFS@
CPPFLAGS = @CPPFLAGS@ @CFLAGS@
CFLAGS = $(CPPFLAGS) 
LDFLAGS = @LDFLAGS@
BLIBS = @BASELIBS@
GLLIBS = @GLLIBS@ -L/usr/X11R6/lib -lGL -lGLU
SDLLIBS = @SDL_LIBS@ 
SDLFLAGS = @SDL_CFLAGS@
GLHEXEN = @GLHEXEN@
HAVE_SDL = @HAVESDL@

# Directories

TOPSRCDIR = @top_srcdir@
TOPOBJDIR = .
SRCDIR    = @srcdir@
VPATH     = @srcdir@
MODULE    = none

INCSUBDIR = include

CPPFLAGS += -I./include

# Objects to build

SDLOBJS = \
	sdl/i_sdl.o

GLBASE = @GLBASE@

GLOBJS = \
	opengl/ogl_clip.o \
	opengl/ogl_draw.o \
	opengl/ogl_rend.o \
	opengl/ogl_rl.o \
	opengl/ogl_sky.o \
	opengl/ogl_tex.o \
	opengl/m_bams.o

BASEOBJS = \
	base/i_linux.o \
	base/oss.o \
	base/i_sound.o \
	base/am_map.o \
	base/ct_chat.o \
	base/d_net.o \
	base/f_finale.o \
	base/g_game.o \
	base/d_main.o \
	base/info.o \
	base/in_lude.o \
	base/mn_menu.o \
	base/m_misc.o \
	base/p_ceilng.o \
	base/p_doors.o \
	base/p_enemy.o \
	base/p_floor.o \
	base/p_inter.o \
	base/p_lights.o \
	base/p_map.o \
	base/p_maputl.o \
	base/p_mobj.o \
	base/p_plats.o \
	base/p_pspr.o \
	base/p_setup.o \
	base/p_sight.o \
	base/p_spec.o \
	base/p_switch.o \
	base/p_telept.o \
	base/p_tick.o \
	base/p_user.o \
	base/r_bsp.o \
	base/r_data.o \
	base/r_draw.o \
	base/r_main.o \
	base/r_plane.o \
	base/r_segs.o \
	base/r_things.o \
	base/sb_bar.o \
	base/sounds.o \
	base/tables.o \
	base/v_video.o \
	base/w_wad.o \
	base/z_zone.o

ifeq "$(GLHEXEN)" "true"
opengl: $(GLBASE) $(GLOBJS) $(BASEOBJS)
	$(CC) -o hheretic-gl $(GLBASE) $(GLOBJS) $(BASEOBJS) $(GLLIBS) $(SDLLIBS)
else
ifeq "$(HAVE_SDL)" "yes"
sdl: $(SDLOBJS) $(BASEOBJS)
	$(CC) -o hheretic-sdl $(SDLOBJS) $(BASEOBJS) $(SDLLIBS)
endif
endif

clean:
	$(RM) base/*.o
	$(RM) x11/*.o
	$(RM) svgalib/*.o
	$(RM) opengl/*.o
	$(RM) sdl/*.o

%.o: %.c
	$(CC) $< -o $@ -c $(CFLAGS) $(SDLFLAGS)

